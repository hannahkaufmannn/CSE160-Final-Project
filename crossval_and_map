Hannah Kaufman
Final Project

```{r}
install.packages("caret")
install.packages("ggplot2")
install.packages("rpart")
install.packages("e1071")
install.packages("kernlab")
install.packages("sf")
```

```{r}
data <- read.csv("data.csv")
```

Linear Regression Accuracy
```{r}
# Split the data into training and testing sets
set.seed(123)  # for reproducibility
num_rows <- nrow(data)
num_train <- floor(0.67 * num_rows)  # 67% for training, 33% for testing
train_indices <- sample(1:num_rows, size = num_train, replace = FALSE)
train_data <- data[train_indices, ]
test_data <- data[-train_indices, ]

# Linear Regression
model_lm <- lm(price ~ zipcode + median_income + bathrooms + bedrooms, data = train_data)
predictions_lm <- predict(model_lm, newdata = test_data)
accuracy_lm <- cor(predictions_lm, test_data$price)

print(paste("Linear Regression Accuracy:", round(accuracy_lm * 100, 2), "%"))
```

Cross Validation
```{r}
library(rpart)
library(caret)

train_control <- trainControl(method = "cv", number = 10)

model_dt_cv <- train(price ~ zipcode + median_income + bathrooms + bedrooms, data = data, method = "rpart", trControl = train_control)

print(model_dt_cv)

```

Map of NYC with shape file
```{r}
library(sf)
library(ggplot2)

zip_file <- "~/Documents/CSE 160/Final Project/zipcodes.zip"
unzip(zip_file)
list.files()
zipcodesgeo <- st_read(dsn = "geo_export_5eb398c0-2f99-41ce-8d48-eec20204f119.shp")


ggplot() +
  geom_sf(data = zipcodesgeo)

```

Map without zip codes
```{r}
library(dplyr)

average_price <- data %>%
  group_by(zipcode) %>%
  summarise(avg_price = mean(price, na.rm = TRUE))

merged_data <- merge(zipcodesgeo, average_price, by.x = "modzcta", by.y = "zipcode", all.x = TRUE)

color_scale <- scale_fill_gradient(low = "lightblue", high = "blue", labels = scales::dollar)

choropleth_map <- ggplot(merged_data, aes(fill = avg_price)) +
  geom_sf() +
  color_scale +
  labs(title = "Average Rental Price Per Zip Code", fill = "Average Rent Price") +
  theme_minimal()

print(choropleth_map)

file_path <- "~/Documents/CSE 160/Final Project/map_no_zip.png"

ggsave(file_path, plot = choropleth_map, width = 10, height = 8, dpi = 300)

```

Map with zip codes printed
```{r}
library(dplyr)
library(ggplot2)

average_price <- data %>%
  group_by(zipcode) %>%
  summarise(avg_price = mean(price, na.rm = TRUE))

merged_data <- merge(zipcodesgeo, average_price, by.x = "modzcta", by.y = "zipcode", all.x = TRUE)

color_scale <- scale_fill_gradient(low = "lightblue", high = "blue", labels = scales::dollar)

choropleth_map <- ggplot(merged_data, aes(fill = avg_price)) +
  geom_sf() +
  geom_sf_text(aes(label = modzcta), size = 1, color = "black", check_overlap = TRUE) +
  color_scale +
  labs(title = "Average Price Choropleth Map", fill = "Average Rent Price") +
  theme_minimal()

print(choropleth_map)

file_path <- "~/Documents/CSE 160/Final Project/map_with_zip.png"

ggsave(file_path, plot = choropleth_map, width = 10, height = 8, dpi = 300)

```
